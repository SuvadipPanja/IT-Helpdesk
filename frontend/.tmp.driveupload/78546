// ============================================
// NEXUS SUPPORT - HELP CENTER COMPONENT
// Complete working version with category clicks fixed
// Developer: Suvadip Panja
// Date: February 1, 2026
// Status: PRODUCTION READY ‚úÖ
// ============================================

import React, { useState, useEffect } from 'react';
import { helpContent } from '../data/helpContent';
import './HelpCenter.css';

const HelpCenter = () => {
  const [selectedCategory, setSelectedCategory] = useState(null);
  const [selectedArticle, setSelectedArticle] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [expandedFAQ, setExpandedFAQ] = useState(null);

  // Filter articles based on category and search
  const filteredArticles = helpContent.articles.filter(article => {
    const matchesCategory = !selectedCategory || article.category === selectedCategory;
    const matchesSearch = !searchQuery || 
      article.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
      article.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
      article.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()));
    return matchesCategory && matchesSearch;
  });

  // Filter FAQs based on category
  const filteredFAQs = helpContent.faqs.filter(faq => {
    if (!selectedCategory) return true;
    return faq.category === selectedCategory || selectedCategory === 'general';
  });

  // Handle article click
  const handleArticleClick = (article) => {
    setSelectedArticle(article);
  };

  // Handle back to articles
  const handleBackToArticles = () => {
    setSelectedArticle(null);
  };

  // Handle category click
  const handleCategoryClick = (categoryId) => {
    setSelectedCategory(categoryId);
    setSelectedArticle(null);
    setSearchQuery('');
  };

  // Handle search
  const handleSearch = (e) => {
    setSearchQuery(e.target.value);
    setSelectedCategory(null);
  };

  // Toggle FAQ
  const toggleFAQ = (faqId) => {
    setExpandedFAQ(expandedFAQ === faqId ? null : faqId);
  };

  // Render article view
  if (selectedArticle) {
    return (
      <div className="help-center">
        <div className="help-container">
          {/* Article View */}
          <div className="article-view">
            <button className="back-button" onClick={handleBackToArticles}>
              ‚Üê Back to Articles
            </button>
            
            <div className="article-header">
              <span className="article-icon">{selectedArticle.icon}</span>
              <div>
                <h1>{selectedArticle.title}</h1>
                <div className="article-meta">
                  <span className="difficulty">{selectedArticle.difficulty}</span>
                  <span className="read-time">‚è±Ô∏è {selectedArticle.readTime}</span>
                  <span className="views">üëÅÔ∏è {selectedArticle.views} views</span>
                  <span className="helpful">üëç {selectedArticle.helpful}% helpful</span>
                </div>
              </div>
            </div>

            <div className="article-content">
              {selectedArticle.content.split('\n').map((paragraph, index) => {
                if (paragraph.startsWith('# ')) {
                  return <h1 key={index}>{paragraph.replace('# ', '')}</h1>;
                } else if (paragraph.startsWith('## ')) {
                  return <h2 key={index}>{paragraph.replace('## ', '')}</h2>;
                } else if (paragraph.startsWith('### ')) {
                  return <h3 key={index}>{paragraph.replace('### ', '')}</h3>;
                } else if (paragraph.startsWith('**') && paragraph.endsWith('**')) {
                  return <p key={index}><strong>{paragraph.replace(/\*\*/g, '')}</strong></p>;
                } else if (paragraph.startsWith('- ') || paragraph.startsWith('* ')) {
                  return <li key={index}>{paragraph.replace(/^[-*] /, '')}</li>;
                } else if (paragraph.trim() === '') {
                  return <br key={index} />;
                } else {
                  return <p key={index}>{paragraph}</p>;
                }
              })}
            </div>

            {selectedArticle.relatedArticles && selectedArticle.relatedArticles.length > 0 && (
              <div className="related-articles">
                <h3>Related Articles</h3>
                <div className="related-grid">
                  {selectedArticle.relatedArticles.map(relatedId => {
                    const related = helpContent.articles.find(a => a.id === relatedId);
                    return related ? (
                      <div 
                        key={related.id}
                        className="related-card"
                        onClick={() => handleArticleClick(related)}
                      >
                        <span className="related-icon">{related.icon}</span>
                        <div>
                          <h4>{related.title}</h4>
                          <p>{related.description}</p>
                        </div>
                      </div>
                    ) : null;
                  })}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  // Main help center view
  return (
    <div className="help-center">
      <div className="help-container">
        {/* Header */}
        <div className="help-header">
          <h1>Help Center</h1>
          <p>Find answers and learn about Nexus Support</p>
        </div>

        {/* Search Bar */}
        <div className="search-section">
          <div className="search-bar">
            <span className="search-icon">üîç</span>
            <input
              type="text"
              placeholder="Search for help articles..."
              value={searchQuery}
              onChange={handleSearch}
            />
            {searchQuery && (
              <button 
                className="clear-search"
                onClick={() => setSearchQuery('')}
              >
                ‚úï
              </button>
            )}
          </div>
        </div>

        {/* Categories Section */}
        {!searchQuery && !selectedCategory && (
          <div className="categories-section">
            <div className="section-header">
              <h2>Browse by Category</h2>
              <p>Find help articles organized by topic</p>
            </div>
            <div className="categories-grid">
              {helpContent.categories.map((category) => (
                <div
                  key={category.id}
                  className="category-card"
                  onClick={() => handleCategoryClick(category.id)}
                  style={{ cursor: 'pointer' }}
                >
                  <div className="category-icon" style={{ backgroundColor: `${category.color}20` }}>
                    <span style={{ fontSize: '2rem' }}>{category.icon}</span>
                  </div>
                  <div className="category-content">
                    <h3>{category.title}</h3>
                    <p>{category.description}</p>
                    <div className="category-meta">
                      <span className="article-count">{category.articleCount} articles</span>
                      <span className="category-arrow">‚Üí</span>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Category Filter Buttons */}
        {(searchQuery || selectedCategory) && (
          <div className="category-filter">
            <button 
              className={`category-btn ${!selectedCategory ? 'active' : ''}`}
              onClick={() => handleCategoryClick(null)}
            >
              All Categories
            </button>
            {helpContent.categories.map((cat) => (
              <button
                key={cat.id}
                className={`category-btn ${selectedCategory === cat.id ? 'active' : ''}`}
                onClick={() => handleCategoryClick(cat.id)}
              >
                <span>{cat.icon}</span> {cat.title}
              </button>
            ))}
          </div>
        )}

        {/* Articles Grid */}
        {(searchQuery || selectedCategory) && (
          <div className="articles-section">
            <div className="section-header">
              <h2>
                {selectedCategory 
                  ? helpContent.categories.find(c => c.id === selectedCategory)?.title + ' Articles'
                  : searchQuery 
                    ? `Search Results for "${searchQuery}"`
                    : 'All Articles'
                }
              </h2>
              <p>{filteredArticles.length} articles found</p>
            </div>
            
            {filteredArticles.length > 0 ? (
              <div className="articles-grid">
                {filteredArticles.map((article) => (
                  <div
                    key={article.id}
                    className="article-card"
                    onClick={() => handleArticleClick(article)}
                  >
                    <span className="article-icon">{article.icon}</span>
                    <h3>{article.title}</h3>
                    <p>{article.description}</p>
                    <div className="article-footer">
                      <span className="difficulty">{article.difficulty}</span>
                      <span className="read-time">‚è±Ô∏è {article.readTime}</span>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="no-results">
                <p>No articles found. Try a different search or browse categories.</p>
              </div>
            )}
          </div>
        )}

        {/* Popular Searches */}
        {!searchQuery && !selectedCategory && (
          <div className="popular-searches">
            <h3>Popular Searches</h3>
            <div className="search-tags">
              {helpContent.popularSearches.map((search, index) => (
                <span 
                  key={index}
                  className="search-tag"
                  onClick={() => setSearchQuery(search)}
                >
                  {search}
                </span>
              ))}
            </div>
          </div>
        )}

        {/* Quick Actions */}
        {!searchQuery && !selectedCategory && (
          <div className="quick-actions">
            <h3>Quick Actions</h3>
            <div className="actions-grid">
              {helpContent.quickLinks.map((link, index) => (
                <div 
                  key={index}
                  className="action-card"
                  style={{ borderLeft: `4px solid ${link.color}` }}
                >
                  <span className="action-icon">{link.icon}</span>
                  <div>
                    <h4>{link.title}</h4>
                    <p>{link.description}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* FAQs */}
        {!searchQuery && !selectedCategory && (
          <div className="faqs-section">
            <div className="section-header">
              <h2>Frequently Asked Questions</h2>
              <p>Quick answers to common questions</p>
            </div>
            <div className="faqs-list">
              {filteredFAQs.map((faq) => (
                <div 
                  key={faq.id}
                  className={`faq-item ${expandedFAQ === faq.id ? 'expanded' : ''}`}
                  onClick={() => toggleFAQ(faq.id)}
                >
                  <div className="faq-question">
                    <h4>{faq.question}</h4>
                    <span className="faq-toggle">{expandedFAQ === faq.id ? '‚àí' : '+'}</span>
                  </div>
                  {expandedFAQ === faq.id && (
                    <div className="faq-answer">
                      <p>{faq.answer}</p>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Keyboard Shortcuts */}
        {!searchQuery && !selectedCategory && (
          <div className="shortcuts-section">
            <h3>Keyboard Shortcuts</h3>
            <div className="shortcuts-grid">
              {helpContent.shortcuts.map((shortcut, index) => (
                <div key={index} className="shortcut-item">
                  <kbd>{shortcut.key}</kbd>
                  <span>{shortcut.description}</span>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Footer */}
        <div className="help-footer">
          <p>Still need help? <a href="/contact">Contact Support</a></p>
        </div>
      </div>
    </div>
  );
};

export default HelpCenter;